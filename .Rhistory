gather(key="sport",value = "averageTime", 2:4)
wasafilter$averageTime<- duration(hour = hour(wasafilter$averageTime), minute = minute(wasafilter$averageTime),
second = second(wasafilter$averageTime))
wasafilter$averageTime <- as.numeric(wasafilter$averageTime)
yLabels <- function(x)
{
x <- seconds_to_period(x)
paste(hour(x),minute(x),second(x), sep = ':')
}
wasafilter <- wasaData18c %>%
filter(gender == "F")%>%
group_by(category)%>%
summarise(avg_swim = mean(Swim),avg_bike = mean(Bike),avg_run = mean(Run))%>%
gather(key="sport",value = "averageTime", 2:4)
wasafilter <- wasafilter %>%
mutate(averageTime = duration(hour = hour(wasafilter$averageTime), minute = minute(wasafilter$averageTime),second = second(wasafilter$averageTime)))%>%
mutate(averageTime = as.numeric(averageTime))
ggplot(wasafilter, aes(x=category, y=averageTime,fill=sport))+
geom_bar(stat="identity")+
scale_y_continuous(labels = labelst)+
coord_flip()
##Filter by gender
filter1 <- "F"
wasaData18FilterG <- wasaData18c %>%
filter(str_detect(category, filter1))
##Filter by Category
filter2 <- "M3034"
wasaData18FilterC <- wasaData18c %>%
filter(str_detect(category, filter2))
paste(filter1,filter2,sep = "")
## Plot Position
ggplot(wasaData18FilterC, aes(x=AgePosition, y = Time))+
geom_point()
##Print Table top 5
datatable(data = wasaData18FilterC[,],
options = list(pageLength = 5),
rownames = FALSE)
#-----------------------------------------------------------------------
#-----------------------------------------------------------------------
#Regresion Model Time
#
#-----------------------------------------------------------------------
#-----------------------------------------------------------------------
#Regresion Model Time
#
pairs(wasaData18c)
#-----------------------------------------------------------------------
#-----------------------------------------------------------------------
#Regresion Model Time
#
str(wasaData18c)
wasaLm18 <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate(time = duration(hour = hour(Time), minute = minute(Time),second = second(Time)))%>%
mutate(averageTime = as.numeric(Time))
wasaLm18 <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate(Time = duration(hour = hour(Time), minute = minute(Time),second = second(Time)))%>%
mutate(Time = as.numeric(Time))
wasaLm18 <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:20),to_seconds)%>%
mutate_at(c(2,6:20),as.numeric)
wasaLm18 <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)
to_seconds <- function(x){
duration(hour = hour(x), minute = minute(x),second = second(x))
}
wasaLm18 <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)
wasaLm18 <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
pairs(wasaLm18)
cor(wasaLm18)
View(wasafilter)
lm(Time ~.,data=wasLm18)
lm(Time ~.,data=wasaLm18)
summary(model1)
model1 <- lm(Time ~.,data=wasaLm18)
summary(model1)
plot(model1)
model1 <- lm(Time ~ -c("position","GenderPosition","AgePosition"),data=wasaLm18)
model1 <- lm(Time ~ category+Swim+T1+Bike+T2+Run+gender,data=wasaLm18)
summary(model1)
p <- predict(model1,wasaLm18)
plot(p,wasaLm18$Time)
plot(p,wasaData15c$Time)
plot(p,wasaLm18$Time)
wasaLm18 <- clean_lm(wasaData18c)
clean_lm <-function(x){
x %>%
select(-c("Name","year","Position"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaLm18 <- clean_lm(wasaData18c)
wasaData18c <- cleandata(wasaData18,2018)
wasaData18 <- read_excel("wasaData.xlsx", sheet = "2018")
wasaData18 <- rename(wasaData18, Division ="20")
wasaLm18 <- clean_lm(wasaData18c)
wasaLm18 <- clean_lm(wasaData18c)
#-----------------------------------------------------------------------
#-----------------------------------------------------------------------
#Regresion Model Time
#
str(wasaData18c)
wasaLm18 <- clean_lm(wasaData18c)
?#clean_lm <- function(x){
wasaData18c%>%
select(-c("Name","year","Position"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
?#clean_lm <- function(x){
wasatest <- wasaData18c %>%
select(-c("Name","year","Position"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
?#clean_lm <- function(x){
wasatest <- wasaData18c %>%
select(-c("Name","year","Position"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
#clean_lm <- function(x){
wasatest <- wasaData18c %>%
select(-c("Name","year","Position"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
#-----------------------------------------------------------------------
#-----------------------------------------------------------------------
#Regresion Model Time
#
str(wasaData18c)
#clean_lm <- function(x){
wasatest <- wasaData18c %>%
select(-c("Name","year","Position"))
#clean_lm <- function(x){
wasatest <- wasaData18c %>%
select(-c("Name","year","Position"))%>%
mutate_at(c(1,5:9),to_seconds)%>%
mutate_at(c(1,5:9),as.numeric)%>%
mutate_at(c("gender","category"),factor)
clean_lm <- function(x){
x %>%
select(-c("Name","year","Position"))%>%
mutate_at(c(1,5:9),to_seconds)%>%
mutate_at(c(1,5:9),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaLm18 <- clean_lm(wasaData18c)
model1 <- lm(Time ~ category+Swim+T1+Bike+T2+Run+gender,data=wasaLm18)
summary(model1)
model2 <- lm(Time ~ Swim+T1+Bike+T2+Run+gender,data=wasaLm18)
summary(model2)
model1 <- lm(Position ~ category+Swim+T1+Bike+T2+Run+gender,data=wasaLm18)
summary(model1)
clean_lm <- function(x){
x %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:9),to_seconds)%>%
mutate_at(c(2,6:9),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaLm18 <- clean_lm(wasaData18c)
model2 <- lm(Position ~ Swim+T1+Bike+T2+Run+gender,data=wasaLm18)
summary(model2)
cor(wasaLm18$Position,wasaLm18$T1)
cor(wasaLm18)
str(wasaLm18)
clean_lm <- function(x){
x %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaLm18 <- clean_lm(wasaData18c)
str(wasaLm18)
pairs(wasaLm18)
library(GGally)
ggpairs(wasaLm18)
ggcorr(wasaLm18)
ggcorr(wasaLm18,label=TRUE)
ggcorr(wasaLm18,label=TRUE,palette="RdBu")
ggcorr(wasaLm18,label=TRUE,palette="RdBu",label_color = "black")
ggcorr(wasaLm18,label=TRUE,palette="RdBu",label_color = "black",color="black")
wasaDataLm <- clean_lm(wasaData)
model2 <- lm(Position ~ Swim+T1+Bike+T2+Run+gender,data=wasaDataLm)
summary(model2)
ggcorr(wasaDataLm,label=TRUE,palette="RdBu",label_color = "black",color="black")
p <- predict(model2,wasaData15c)
p <- predict(model2,clean_lm(wasaData15c))
plot(p,clean_lm(wasaData15c$Time))
plot(p,clean_lm(wasaData15c)$Time)
p <- predict(model2,clean_lm(wasaData18c))
plot(p,clean_lm(wasaData18c)$Time)
plot(model2)
model2 <- lm(Position ~ Swim+T1+Bike+T2+Run+gender+category,data=wasaDataLm)
summary(model2)
plot(model2)
ggcorr(wasaDataLm,label=TRUE,palette="RdBu",label_color = "black",color="black")
testD <- data.frame(Swim=1570,T1=6300,Bike=3790,T2=2640,gender ="M",category="2529")
View(testD)
head(WasaDataLm)
head(wasaDataLm)
View(wasaDataLm)
seconds_to_period(wasaDataLm$Time)
seconds_to_period(wasaDataLm$T1)
clean_lm <- function(x){
x %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
seconds_to_period(wasaDataLm$T1)
clean_lm <- function(x){
x %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6:10),to_seconds)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
#-----------------------------------------------------------------------
#-----------------------------------------------------------------------
#Regresion Model Time
#
str(wasaData18c)
t1 <- to_seconds(wasaData18c)
t1 <- to_seconds(wasaData18c)
to_seconds <- function(x){
duration(hour = hour(x), minute = minute(x),second = second(x))
}
t1 <- to_seconds(wasaData18c)
t1 <- duration(hour = hour(wasaData18c), minute = minute(wasaData18c),second = second(wasaData18c))
t1 <- duration(hour = hour(wasaData18c$Time), minute = minute(wasaData18c$Time),second = second(wasaData18c$Time))
t2 <- t1 <- duration(hour = hour(wasaData18c$T1), minute = minute(wasaData18c$T1),second = second(wasaData18c$T1))
t1 <- duration(hour = hour(wasaData18c$Time), minute = minute(wasaData18c$Time),second = second(wasaData18c$Time))
t2 <- t1 <- duration(hour = hour(wasaData18c$T1), minute = minute(wasaData18c$T1),second = second(wasaData18c$T1))
as.numeric(t1)
as.numeric(t2)
t1 <- duration(hour = hour(wasaData18c$Time), minute = minute(wasaData18c$Time),second = second(wasaData18c$Time))
t2 <- duration(hour = hour(wasaData18c$T1), minute = minute(wasaData18c$T1),second = second(wasaData18c$T1))
as.numeric(t1)
as.numeric(t2)
t2 <- duration( minute = minute(wasaData18c$T1),second = second(wasaData18c$T1))
as.numeric(t1)
as.numeric(t2)
wasaData18c$T1 = as.char(wasaData18c)
wasaData18c$T1 = as.character(wasaData18c)
wasaData18c$T1 = as.character(wasaData18c$T1)
wasaData18c$T1 %>% str_split(" ")[2]
t3 <- wasaData18c %>%
str_split(T1," ")[2]
library(stringr)
t3 <- wasaData18c %>%
str_split(T1," ")[2]
t3 <- wasaData18c %>%
str_split("T1"," ")[2]
t3 <- wasaData18c %>%
str_split_fixed(T1," ")[2]
t3 <- wasaData18c %>%
str_split_fixed(T1," ",n=2)[2]
View(wasaData18c)
View(wasaData18c)
t3 <- wasaData18c %>%
str_split_fixed(T1," ",n=2)
t3 <- wasaData18c %>%
str_split(T1,"")
t3 <- wasaData18c %>%
str_split(wasaData18c$T1,"")
t3 <- wasaData18c %>%
separate(T1,into = c("date","time"),sep = " ")
t3 <- wasaData18c %>%
separate(T1,into = c("date","T1"),sep = " ")
t3 <- wasaData18c %>%
separate(T1,into = c("date","T1"),sep = " ")%>%
str_replace(T1,":00","")
t3 <- wasaData18c %>%
separate(T1,into = c("date","T1"),sep = " ")%>%
str_replace(T1,":00"," ")
t3 <- wasaData18c %>%
separate(T1,into = c("date","T1"),sep = " ")%>%
str_replace(T1,":00")
t3 <- wasaData18c %>%
separate(T1,into = c("date","T1"),sep = " ")%>%
mutate (T1 =str_replace(T1,":00".""))
t3 <- wasaData18c %>%
separate(T1,into = c("date","T1"),sep = " ")%>%
mutate (T1 =str_replace(T1,":00",""))
cleandata <- function(x,y) {
x %>%
rename(category ="Division",age_group = "Place/Division",genderP ="Place/Gender")%>%
separate(age_group,into = c("AgePosition","ToalAge"), sep = "/")%>%
separate(genderP,into = c("GenderPosition","ToaGender"), sep = "/")%>%
separate(Place,into = c("Position","TotalP"), sep = "/")%>%
fill(Swim, T1,Bike,T2,Run)%>%
select(-c("Event","Race #","ToalAge","ToaGender","TotalP"))%>%
mutate_at(c(5:6,1),as.numeric)%>%
filter(str_detect(category,"(^F|^M)(?=\\d)"))%>%
mutate(category=as.factor(category),gender = ifelse(str_detect(category,"F"),"F","M"))%>%
mutate(gender = as.factor(gender),year = as.factor(y),category = str_replace(category,"[A-Z]",""))%>%
mutate_at(c("T1","T2"), as.character)%>%
separate(T1,into = c("date","T1"),sep = " ")%>%
separate(T2,into = c("date2","T2"),sep = " ")%>%
mutate (T2 =str_replace(T2,":00",""))%>%
select(-c("date","date2"))%>%
filter(!is.na(Time))
}
wasaData18c <- cleandata(wasaData18,2018)
cleandata <- function(x,y) {
x %>%
rename(category ="Division",age_group = "Place/Division",genderP ="Place/Gender")%>%
separate(age_group,into = c("AgePosition","ToalAge"), sep = "/")%>%
separate(genderP,into = c("GenderPosition","ToaGender"), sep = "/")%>%
separate(Place,into = c("Position","TotalP"), sep = "/")%>%
fill(Swim, T1,Bike,T2,Run)%>%
select(-c("Event","Race #","ToalAge","ToaGender","TotalP"))%>%
mutate_at(c(5:6,1),as.numeric)%>%
filter(str_detect(category,"(^F|^M)(?=\\d)"))%>%
mutate(category=as.factor(category),gender = ifelse(str_detect(category,"F"),"F","M"))%>%
mutate(gender = as.factor(gender),year = as.factor(y),category = str_replace(category,"[A-Z]",""))%>%
mutate_at(c("T1","T2"), as.character)%>%
separate(T1,into = c("date","T1"),sep = " ")%>%
separate(T2,into = c("date2","T2"),sep = " ")%>%
mutate (T2 =str_replace(T2,":00",""), T1=str_replace(T1,":00",""))%>%
select(-c("date","date2"))%>%
filter(!is.na(Time))
}
wasaData18c <- cleandata(wasaData18,2018)
to_seconds <- function(x){
duration(hour = hour(x), minute = minute(x),second = second(x))
}
to_seconds(wasaData18c$T1)
clean_lm <- function(x){
x %>%
select(-c("Name","year"))%>%
mutate_at(c(2,7,9,11),to_seconds)%>%
mutate_at(c(8,10),ms)%>%
mutate_at(c(2,7:11),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
#clean_lm <- function(x){
test <- wasaData18c %>%
select(-c("Name","year"))
View(test)
#clean_lm <- function(x){
test <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate_at(c(2,7,9,11),to_seconds)
#clean_lm <- function(x){
test <- wasaData18c %>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)
clean_lm <- function(x){
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
clean_lm <- function(x){
x%>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
View(wasaDataLm)
clean_lm <- function(x){
x%>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms)
#mutate_at(c(2,6:10),as.numeric)%>%
#mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
t6 <- ms(wasaData18c$T1)
as.numeric(t6)
clean_lm <- function(x){
x%>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms)
#mutate_at(c(2,6:10),as.numeric)%>%
#mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
cleandata <- function(x,y) {
x %>%
rename(category ="Division",age_group = "Place/Division",genderP ="Place/Gender")%>%
separate(age_group,into = c("AgePosition","ToalAge"), sep = "/")%>%
separate(genderP,into = c("GenderPosition","ToaGender"), sep = "/")%>%
separate(Place,into = c("Position","TotalP"), sep = "/")%>%
fill(Swim, T1,Bike,T2,Run)%>%
select(-c("Event","Race #","ToalAge","ToaGender","TotalP"))%>%
mutate_at(c(5:6,1),as.numeric)%>%
filter(str_detect(category,"(^F|^M)(?=\\d)"))%>%
mutate(category=as.factor(category),gender = ifelse(str_detect(category,"F"),"F","M"))%>%
mutate(gender = as.factor(gender),year = as.factor(y),category = str_replace(category,"[A-Z]",""))%>%
mutate_at(c("T1","T2"), as.character)%>%
separate(T1,into = c("date","T1"),sep = " ")%>%
separate(T2,into = c("date2","T2"),sep = " ")%>%
mutate (T2 =str_replace(T2,":00",""), T1=str_replace(T1,":00",""))%>%
select(-c("date","date2"))%>%
filter(!is.na(Time))
}
wasaData18c <- cleandata(wasaData18,2018)
wasaData17c <- cleandata(wasaData17,2017)
wasaData16c <- cleandata(wasaData16,2016)
wasaData15c <- cleandata(wasaData15,2015)
wasaData <- bind_rows(wasaData18c,wasaData17c,wasaData16c,wasaData15c)
wasaData$year <- as.factor(wasaData$year)
clean_lm <- function(x){
x%>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms),
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
clean_lm <- function(x){
x%>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms),
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
clean_lm <- function(x){
x%>%
select(-c("Name","year"))%>%
mutate_at(c(2,6,8,10),to_seconds)%>%
mutate_at(c(7,9),ms)%>%
mutate_at(c(2,6:10),as.numeric)%>%
mutate_at(c("gender","category"),factor)
}
wasaDataLm <- clean_lm(wasaData)
model2 <- lm(Position ~ Swim+T1+Bike+T2+Run+gender+category,data=wasaDataLm)
summary(model2)
plot(model2)
ggcorr(wasaDataLm,label=TRUE,palette="RdBu",label_color = "black",color="black")
View(wasaData)
View(wasaDataLm)
summary(model2)
model2 <- lm(Position ~ Swim+T1+Bike+T2+Run+gender,data=wasaDataLm)
summary(model2)
testD <- data.frame(Swim=1570,T1=130,Bike=3850,T2=120,gender ="M",category="2529")
p <- predict(model2,testD)
testD <- data.frame(Swim=1570,T1=130,Bike=3850,T2=120,gender ="M",category="2529")
p <- predict(model2,testD)
model2 <- lm(Position ~ Swim+T1+Bike+T2+Run+gender+category,data=wasaDataLm)
summary(model2)
testD <- data.frame(Swim=1570,T1=130,Bike=3850,T2=120,gender ="M",category="2529")
p <- predict(model2,newdata = testD)
wasa18 <- clean_lm(wasaData18c)
p <- predict(model2, wasa18)
p <- round(predict(model2, wasa18))
plot(p,wasa18$Position)
testD <- data.frame(Swim=1570,T1=130,Bike=3850,T2=120,Run=2600,gender ="M",category="2529")
p <- round(predict(model2, testD))
testD <- data.frame(Swim=1349,T1=100,Bike=3790,T2=44,Run=2248,gender ="M",category="2529")
p <- round(predict(model2, testD))
wasa18 <- clean_lm(wasaData14c)
wasa18 <- clean_lm(wasaData15c)
p <- round(predict(model2, wasa18))
plot(p,wasa18$Position)
runApp()
flm <- formula(Position ~ Swim+T1+Bike+T2+Run+gender+category)
model2 <- lm(flm,data=wasaDataLm)
flm <- formula(Position ~ Swim+T1+Bike+T2+Run+gender)
model2 <- lm(flm,data=wasaDataLm)
wasaDataAge1 <- wasaData %>%
filter(category == "1824", gender = "M")
wasaDataAge1 <- wasaData %>%
filter(category == "1824", gender == "M")
m <- lm(flm,data=wasaDataAge1)
flm <- formula(Position ~ Swim+T1+Bike+T2+Run)
wasaDataAge1 <- wasaData %>%
filter(category == "1824", gender == "M")
m <- lm(flm,data=wasaDataAge1)
testD <- data.frame(Swim=1349,T1=100,Bike=3790,T2=44,Run=2248)
p(round(predict(m,testD)))
pAge <- (round(predict(m,testD)))
wasaDataAge1 <- wasaDataLm %>%
filter(category == "1824", gender == "M")
m <- lm(flm,data=wasaDataAge1)
testD <- data.frame(Swim=1349,T1=100,Bike=3790,T2=44,Run=2248)
pAge <- (round(predict(m,testD)))
m <- lm(flm,data=wasaDataAge1)
testD <- data.frame(Swim=1349,T1=100,Bike=3790,T2=44,Run=2248)
pAge <- (round(predict(m,testD)))
testD <- data.frame(Swim=1449,T1=100,Bike=3790,T2=44,Run=2248)
pAge <- (round(predict(m,testD)))
runApp()
